/* Custom script for Walt Disney World from Walt Disney Travel Company v1.0.0 */
/* Author: Tom Nelson, March 2015 */

// -------------------------------------------------------------------------------------------------------------------
var QuestionsAndAnswersDetails = {
	
	RoundOne: {
		answer: "Four",
		image: "<img src='http://uk.disneydevelopment.co.uk/walt-disney-world/images/competition/jollywisequiz_roundone.png' alt='Jake and the neverland pirates'>",
		tickOrCrossButton: '#roundone',
		linkToNextRoundOfQuiz: "/walt-disney-world/magical-extras/"
	},
	
	RoundTwo: {
		answer: "All of the above",
		image: "<img src='http://uk.disneydevelopment.co.uk/walt-disney-world/images/competition/jollywisequiz_roundtwo.png' alt='Jake and the neverland pirates'>",
		tickOrCrossButton: '#roundtwo',
		linkToNextRoundOfQuiz: "/walt-disney-world/tickets/"
	},
	
	RoundThree: {
		answer: "All of the above",
		image: "<img src='http://uk.disneydevelopment.co.uk/walt-disney-world/images/competition/jollywisequiz_roundthree.png' alt='Jake and the neverland pirates'>",
		tickOrCrossButton: '#roundthree',
		linkToNextRoundOfQuiz: "http://competition.disneyholidays.co.uk"
	}
};	

var StatusOfRoundsInQuiz = {

	currentRound: QuestionsAndAnswersDetails.RoundOne,
	currentUsersAnswer: null,
	
	roundProgress: function() {
				
		if($('#jollyWiseQuiz-two').length != 0) {
			StatusOfRoundsInQuiz.currentRound = QuestionsAndAnswersDetails.RoundTwo;
		} else if($('#jollyWiseQuiz-three').length != 0) {
			StatusOfRoundsInQuiz.currentRound = QuestionsAndAnswersDetails.RoundThree;
		} else {
			StatusOfRoundsInQuiz.currentRound = QuestionsAndAnswersDetails.RoundOne;
		}
	}
};

var CreateAndSetCookiesForQuiz = {
		
	CookieForRoundOne: {
		cookieName: "TreasureHuntQ1",
		cookieValue: "true"	
	},
	
	CookieForRoundTwo: {
		cookieName: "TreasureHuntQ2",
		cookieValue: "true"	
	},
	
	CookieForRoundThree: {
		cookieName: "TreasureHuntQ3",
		cookieValue: "true"	
	},
	
	setCorrectCookieForEachRound: function() {
		
		if(StatusOfRoundsInQuiz.currentRound === QuestionsAndAnswersDetails.RoundOne) {
			CreateAndSetCookiesForQuiz.setCookie(CreateAndSetCookiesForQuiz.CookieForRoundOne.cookieName, CreateAndSetCookiesForQuiz.CookieForRoundOne.cookieValue);
		} else if(StatusOfRoundsInQuiz.currentRound === QuestionsAndAnswersDetails.RoundTwo) {
			CreateAndSetCookiesForQuiz.setCookie(CreateAndSetCookiesForQuiz.CookieForRoundTwo.cookieName, CreateAndSetCookiesForQuiz.CookieForRoundTwo.cookieValue);
		} else {
			CreateAndSetCookiesForQuiz.setCookie(CreateAndSetCookiesForQuiz.CookieForRoundThree.cookieName, CreateAndSetCookiesForQuiz.CookieForRoundThree.cookieValue);
		}	
	},
	
	setCookie: function(cookieName, cookieValue) {
		document.cookie = cookieName + "=" + cookieValue + "; path=/";
	}
};
	
var QuizCreator = {
	
	run: function() {
		QuizCreator.disableMousePointerIfElementStatusIsSetToDisabled();
		QuizCreator.insertImage();
		QuizCreator.registerClickHandlerForAnswersButton();
	},
	
	disableMousePointerIfElementStatusIsSetToDisabled: function() {
		$('#nextButton').addClass('clickDisabled').find('input').addClass('clickDisabled');
		$('#progressBarTicks span').addClass('clickDisabled');	
	},
	
	insertImage: function() {
		$('#jollyWiseQuiz').append('<span id="jollyWiseQuizImage"></span>'); // delete when Tom adds this in SS
		var currentRoundImage = StatusOfRoundsInQuiz.currentRound.image;
		$('#jollyWiseQuiz').find('#jollyWiseQuizImage').html(currentRoundImage);
	},
	
	registerClickHandlerForAnswersButton: function() {
		
		$('#answers span input').click(function() {
			$(this).parent().addClass('usersSelectedAnswer').siblings().removeClass('usersSelectedAnswer');
			$(this).addClass('usersSelectedAnswer').parent('span').siblings().children().removeClass('usersSelectedAnswer');				
			StatusOfRoundsInQuiz.currentUsersAnswer = $(this).attr('value');
			QuizCreator.checksIfUsersAnswerIsCorrect();
		});		
	},
	
	checksIfUsersAnswerIsCorrect: function() {
		
		if(StatusOfRoundsInQuiz.currentUsersAnswer === StatusOfRoundsInQuiz.currentRound.answer) {
			QuizCreator.saveUsersAnswerWhenCorrect(StatusOfRoundsInQuiz.currentUsersAnswer);
			QuizCreator.tickButtonIfCorrect();
			$('#nextButton').removeClass('clickDisabled').find('input').removeClass('clickDisabled');	
			$('#answers span input').off('click');
		} else {
			QuizCreator.crossButtonIfIncorrect();
			$('#nextButton').off('click');
		}
	},
	
	crossButtonIfIncorrect: function() {
		var roundbuttonToTick = StatusOfRoundsInQuiz.currentRound.tickOrCrossButton;
		$('#progressBarTicks').find(roundbuttonToTick).addClass('incorrectAnswer').find('p').html('&#x2717;');
	},
	
	tickButtonIfCorrect: function() {
		var roundbuttonToTick = StatusOfRoundsInQuiz.currentRound.tickOrCrossButton;
		$(roundbuttonToTick).removeClass('incorrectAnswer disabled').addClass('button').find('p').html('&#10004;');
		$('#answers .usersSelectedAnswer').removeClass('usersSelectedAnswer').addClass('correctAnswer');
		QuizCreator.registerClickHandlerForNextButton();
	},
	
	saveUsersAnswerWhenCorrect: function(answerToSave) {
		QuizCreator.makeNextButtonClickable();		
	},
	
	makeNextButtonClickable: function()  {
		$('#nextButton').removeClass('disabled').addClass('button');
	},
	
	registerClickHandlerForNextButton: function() {
		
		$('#nextButton').click(function() { 
			CreateAndSetCookiesForQuiz.setCorrectCookieForEachRound();

			var nextRoundOfQuizLink = StatusOfRoundsInQuiz.currentRound.linkToNextRoundOfQuiz;
			$('#nextButton').attr('href', nextRoundOfQuizLink);
		});
	}
};	


$(document).ready(function() {
	StatusOfRoundsInQuiz.roundProgress();
	QuizCreator.run();
});	
